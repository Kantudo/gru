var q=Object.defineProperty;var j=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var k=(n,t,s)=>t in n?q(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,z=(n,t)=>{for(var s in t||(t={}))V.call(t,s)&&k(n,s,t[s]);if(j)for(var s of j(t))X.call(t,s)&&k(n,s,t[s]);return n};var p=(n,t,s)=>(k(n,typeof t!="symbol"?t+"":t,s),s);import{l as J,t as Y,R as d,a as _}from"./vendor.898904d5.js";const $=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}};$();async function F(){let n="MLP_3hl_128nphl";return n+="/model.json",n.includes("MLP")&&(n="mlp/"+n),await J(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+(window.location.hostname.includes("github")?"/gru/":"/")+"models/"+n)}class O{constructor(){this.top=1/0,this.bottom=0,this.left=1/0,this.right=0,Object.defineProperty(this,"width",{get:function(){return this.right-this.left},enumerable:!0}),Object.defineProperty(this,"height",{get:function(){return this.bottom-this.top},enumerable:!0}),Object.defineProperty(this,"ratio",{get:function(){return this.width/this.height},enumerable:!0}),Object.defineProperty(this,"size",{get:function(){return this.width*this.height},enumerable:!0}),this.add=function(s,e){this.top=Math.min(this.top,e),this.bottom=Math.max(this.bottom,e+1),this.left=Math.min(this.left,s),this.right=Math.max(this.right,s+1)},this.intersect=function(s){var e=!(s.left>this.right||s.right<this.left||s.top>this.bottom||s.bottom<this.top);return e&&(e=new O,e.left=Math.max(this.left,s.left),e.top=Math.max(this.top,s.top),e.right=Math.min(this.right,s.right),e.bottom=Math.min(this.bottom,s.bottom)),e},this.merge=function(s,e){if(e){var i=this.intersect(s);if(!i||i.size<this.size/4)return}this.top=Math.min(this.top,s.top),this.bottom=Math.max(this.bottom,s.bottom),this.left=Math.min(this.left,s.left),this.right=Math.max(this.right,s.right)}}}class D{constructor(t){this.level=t,this.moments=[0,0,0,0,0],this.area=0,this.variation=1/0,this.stable=!1,this.rect=new O,this.accumulate=function(e,i){this.area+=1,this.moments[0]+=e,this.moments[1]+=i,this.moments[2]+=e*e,this.moments[3]+=e*i,this.moments[4]+=i*i,this.rect.add(e,i)},this.merge=function(e){this.area+=e.area,this.moments[0]+=e.moments[0],this.moments[1]+=e.moments[1],this.moments[2]+=e.moments[2],this.moments[3]+=e.moments[3],this.moments[4]+=e.moments[4],e.next=this.child,this.child=e,e.parent=this,this.rect.merge(e.rect)},this.process=function(e,i,o,a,u){for(var h=this;h.parent&&h.parent.level<=this.level+e;)h=h.parent;for(this.variation=(h.area-this.area)/this.area,this.stable=this.area>=i&&this.area<=o&&this.variation<=a,h=this.parent;h&&this.area>u*h.area;h=h.parent)h.variation<=this.variation&&(this.stable=!1),this.variation<h.variation&&(h.stable=!1);for(var c=this.child;c;c=c.next)c.process(e,i,o,a)},this.save=function(e){this.stable&&e.push(this);for(var i=this.child;i;i=i.next)i.save(e)},this.getRect=function(){return this.rect}}}class K{constructor(t){var s=Object.assign({delta:2,minArea:5e-4,maxArea:.1,maxVariation:.5,minDiversity:.5},t),e=256;this.eight=!0,this.extract=function(o){var a=[],u=[],h=[],c=e,l=[],C=[],y=o.data,f=o.width,w=o.height,R=function(N,G){for(var B;N>l[l.length-1].level;){if(B=l.pop(),N<l[l.length-1].level){l.push(new D(N,G)),l[l.length-1].merge(B);return}l[l.length-1].merge(B)}},E=0,r,m=y.length;for(r=0;r<m;r+=4)a[E]=y[r],E+=1;for(m=f*w,r=0;r<m;r+=1)u[r]=!1;for(r=0;r<e;r+=1)h[r]=[];l.push(new D(e));var g=0,x=0,v=a[0];u[0]=!0,l.push(new D(v));for(var b,T,I,S,M,P,L,U=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]];;){for(b=g%f,T=Math.floor(g/f);x<(this.eight?8:4);++x)if(I=b+U[x][0],S=T+U[x][1],I>=0&&S>=0&&I<f&&S<w&&(M=S*f+I,!u[M])){if(P=a[M],u[M]=!0,P<v){h[v].push(g<<4|x+1),c=Math.min(v,c),g=M,x=0,v=P,l.push(new D(v)),b=g%f,T=Math.floor(g/f);continue}h[P].push(M<<4),c=Math.min(P,c)}if(l[l.length-1].accumulate(b,T),c===e)return R(e,g),l[l.length-1].process(s.delta,s.minArea*f*w,s.maxArea*f*w,s.maxVariation,s.minDiversity),l[l.length-1].save(C),C;for(g=h[c][h[c].length-1]>>4,x=h[c][h[c].length-1]&15,h[c].pop();c<e&&h[c].length===0;)++c;L=a[g],L!==v&&(R(L,g),v=L)}}}}let A;(async()=>{A=await F()})();let Q=new K({delta:100,minArea:1e-4,maxArea:.5,maxVariation:.5,minDiversity:.33});function W(n){let t=n.getContext("2d");if(!t)throw"Could not get context";let s=t.getImageData(0,0,n.width,n.height),e={x:0,y:0},i=z({},e),o=z({},e);for(var a=0;a<s.data.length;a+=4)s.data[a+3]!==0&&((e.x<=i.x||i.x==0)&&(i.x=e.x),(e.y<=i.y||i.y==0)&&(i.y=e.y),(e.x>=o.x||o.x==0)&&(o.x=e.x),(e.y>=o.y||o.y==0)&&(o.y=e.y)),e.x+=1,e.x==n.width&&(e.x=0,e.y+=1);return{upperLeft:i,lowerRight:o}}function Z(n,t){t||(t=W(n));let{upperLeft:s,lowerRight:e}=t,i=document.createElement("canvas"),o=i.getContext("2d");if(!o)throw"Could not get context";i.width=500,i.height=500;let a=e.x-s.x,u=e.y-s.y,h=a/u;return a>u?(a=300,u=a/h):(u=300,a=u*h),o.drawImage(n,s.x,s.y,e.x-s.x,e.y-s.y,250-a/2,250-u/2,a,u),i}function H(n,t){let s=[],e=[];for(var i=0;i<n.data.length;i+=4)n.data[i+3]==0?(n.data[i]=0,n.data[i+1]=0,n.data[i+2]=0,n.data[i+3]=255,e.push(0)):(n.data[i]=255,n.data[i+1]=255,n.data[i+2]=255,e.push(n.data[i+3]==255?255:0)),e.length==t&&(s.push(e),e=[]);return s}function tt(n){for(var t=0;t<n.data.length;t+=4)n.data[t+3]==0?(n.data[t]=255,n.data[t+1]=255,n.data[t+2]=255,n.data[t+3]=255):(n.data[t]=0,n.data[t+1]=0,n.data[t+2]=0,n.data[t+3]=255);return n}function et(n,t,s){return new Promise((e,i)=>{let o=n.toDataURL(),a=document.createElement("canvas");a||i("Canvas failed to initialize"),a.width=28,a.height=28;let u=a.getContext("2d"),h=n.getContext("2d"),c=document.createElement("img");c.src=o,c.onload=()=>{let l=h.getImageData(0,0,n.width,n.height);tt(l);let C=Q.extract(l).map(r=>r.rect),y,f;u.scale(t/c.width,s/c.height);let w=[],R=[];C.forEach(r=>{let m={upperLeft:{x:r.left,y:r.top},lowerRight:{x:r.left+r.width,y:r.top+r.height}};R.push(m),u.clearRect(0,0,500,500),u.drawImage(Z(n,m),0,0),y=u.getImageData(0,0,t,s),f=H(y,t);let g=f.map(v=>v.map(b=>[b])),x=A.predict(Y([g],[1,28,28,1]));w.push({prediction:x.dataSync().indexOf(1),left:r.left}),console.log(x),u.putImageData(y,0,0)}),w.sort((r,m)=>r.left-m.left);let E=parseInt(w.reduce((r,m)=>r+(m.prediction>=0?m.prediction:""),""));console.log("Number "+E),e({img:a.toDataURL(),boundingBoxes:R,prediction:E})},c.onerror=i})}class st extends d.Component{constructor(t){super(t);p(this,"canvasRef");p(this,"imgRef");p(this,"canvas");p(this,"canvasBoundingRect");p(this,"context");p(this,"state");p(this,"canvas2");p(this,"context2");this.state={pen:{color:"#ff7f90",size:25},pts:[],touchPts:[],isDown:!1,guess:""},this.canvasRef=d.createRef(),this.imgRef=d.createRef(),this.canvas=null,this.context=null,this.canvasBoundingRect=null,this.drawPoints=this.drawPoints.bind(this),this.drawPointsTouch=this.drawPointsTouch.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.getContext=this.getContext.bind(this),this.clear=this.clear.bind(this),this.updateImg=this.updateImg.bind(this),this.getEventRelativeCoordinates=this.getEventRelativeCoordinates.bind(this),this.handleResize=this.handleResize.bind(this)}getContext(){var t,s,e,i;!this.canvasRef.current||(this.canvas=this.canvasRef.current,this.canvas2=document.createElement("canvas"),this.context2=(s=(t=this.canvas2)==null?void 0:t.getContext("2d"))!=null?s:null,this.context=(i=(e=this.canvas)==null?void 0:e.getContext("2d"))!=null?i:null,this.canvas&&(this.canvasBoundingRect=this.canvas.getBoundingClientRect(),this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))}componentDidMount(){this.getContext(),window.addEventListener("resize",this.handleResize)}componentDidUpdate(){if(this.canvas2&&this.context2&&this.canvas){let t=this.canvas2;this.getContext(),this.context2.drawImage(t,0,0,this.canvas.width,this.canvas.height)}}handleResize(){this.componentDidUpdate()}clear(){this.context&&this.canvas&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2&&this.canvas2&&this.context2.clearRect(0,0,this.canvas2.width,this.canvas2.height)}updateImg(){this.canvas&&et(this.canvas,28,28).then(({img:t,boundingBoxes:s,prediction:e})=>{if(this.imgRef.current&&(this.imgRef.current.src=t),!this.context)return null;this.setState({guess:e.toString()})})}onMouseDown(t){t.preventDefault(),this.state.isDown=!0,this.state.pts.push(this.getEventRelativeCoordinates(t)),this.drawPoints()}onTouchStart(t){this.state.isDown=!0,this.getEventRelativeCoordinates(t).forEach(e=>{this.state.touchPts.push([e])}),this.drawPointsTouch()}onMouseUp(t){t.preventDefault(),this.state.isDown=!1,this.context2&&this.canvas&&this.context2.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2&&this.canvas&&this.context2.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height),this.setState({pts:[]}),this.updateImg()}onTouchEnd(t){this.state.isDown=!1,this.context2&&this.canvas&&this.context2.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2&&this.canvas&&this.context2.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height),this.setState({touchPts:[]}),this.updateImg()}onMouseMove(t){t.preventDefault(),!(!this.state.isDown||!this.context||!this.canvas)&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas2&&this.context.drawImage(this.canvas2,0,0),this.state.pts.push(this.getEventRelativeCoordinates(t)),this.drawPoints())}onTouchMove(t){let s=this.getEventRelativeCoordinates(t);console.log(s.length),s.forEach((e,i)=>{if(!(i>1)){if(!this.state.isDown||!this.context||!this.canvas||!this.canvas2)throw"No canvas";this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.canvas2,0,0),this.state.touchPts[this.state.touchPts.length-1-i].push(e),this.drawPointsTouch()}})}getEventRelativeCoordinates(t){if(!this.canvasBoundingRect)throw"No bounding rect for canvas found";if(t.nativeEvent instanceof TouchEvent){t=t;let s=[];for(let e=0;e<t.touches.length;e++)s.push({x:(t.touches[e].clientX-this.canvasBoundingRect.left)*t.target.width/this.canvasBoundingRect.width,y:(t.touches[e].clientY-this.canvasBoundingRect.top)*t.target.height/this.canvasBoundingRect.height});return s}else return t=t,{x:(t.clientX-this.canvasBoundingRect.left)*t.target.width/this.canvasBoundingRect.width,y:(t.clientY-this.canvasBoundingRect.top)*t.target.height/this.canvasBoundingRect.height}}drawPointsTouch(){this.state.touchPts.forEach(t=>{if(!!this.context){this.context.lineCap="round",this.context.lineWidth=this.state.pen.size;var s=0,e=t.length>1?1:0;for(this.context.beginPath(),this.context.lineJoin="round",this.context.moveTo(t[0].x,t[0].y);s<t.length-e;s++)this.context.quadraticCurveTo(t[s].x,t[s].y,(t[s].x+t[s+e].x)/2,(t[s].y+t[s+e].y)/2);this.context.strokeStyle=this.state.pen.color,this.context.stroke(),this.context.closePath()}})}drawPoints(){if(!this.context)return;this.context.lineCap="round",this.context.lineWidth=this.state.pen.size;let t=this.state.pts;var s=0,e=t.length>1?1:0;for(this.context.beginPath(),this.context.lineJoin="round",this.context.moveTo(t[0].x,t[0].y);s<t.length-e;s++)this.context.quadraticCurveTo(t[s].x,t[s].y,(t[s].x+t[s+e].x)/2,(t[s].y+t[s+e].y)/2);this.context.strokeStyle=this.state.pen.color,this.context.stroke(),this.context.closePath()}render(){return d.createElement("div",null,d.createElement("div",{className:"flex justify-between p-3 border-4 border-gray-500 border-dashed rounded-3xl mb-2"},d.createElement("div",{className:"flex flex-col justify-center"},d.createElement("button",{className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-light font-mono py-2 px-4 rounded-2xl focus:outline-none",onMouseUpCapture:()=>this.clear()},"clear")),d.createElement("div",{className:"inline-flex"},d.createElement("div",{className:"flex flex-col justify-center"},d.createElement("div",{className:"text-stroke-cyan-700 p-2 text-transparent opacity-85   overflow-hidden text-4xl text-stroke-sm md:text-stroke-md "},"Guess:")),d.createElement("div",{className:"flex flex-col justify-center"},d.createElement("div",{className:"text-stroke-orange-300 p-2 text-transparent opacity-85   overflow-hidden text-4xl text-stroke-sm md:text-stroke-md"},this.state.guess)))),d.createElement("canvas",{className:" border-4 border-gray-500 border rounded-3xl shadow-2xl",onMouseMove:t=>this.onMouseMove(t),onMouseDown:t=>this.onMouseDown(t),onMouseUp:t=>this.onMouseUp(t),onMouseLeave:t=>this.onMouseUp(t),onTouchMove:t=>this.onTouchMove(t),onTouchStart:t=>this.onTouchStart(t),onTouchEnd:t=>this.onTouchEnd(t),ref:this.canvasRef,width:"500",height:"500",style:{padding:"0",margin:"auto",display:"block",width:"100%",touchAction:"none"}}),d.createElement("img",{ref:this.imgRef,width:"200px",className:" border-4 border-gray-500"}))}}class it extends d.Component{render(){return d.createElement("div",{style:{display:"grid",placeItems:"center",width:"100%",paddingTop:"10px"}},d.createElement(st,null))}}_.render(d.createElement(d.StrictMode,null,d.createElement(it,null)),document.getElementById("root"));
