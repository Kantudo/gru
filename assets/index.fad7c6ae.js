var t=Object.defineProperty,e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,a=(t,a)=>{for(var o in a||(a={}))s.call(a,o)&&i(t,o,a[o]);if(e)for(var o of e(a))n.call(a,o)&&i(t,o,a[o]);return t},o=(t,e,s)=>(i(t,"symbol"!=typeof e?e+"":e,s),s);import{R as h,a as c,b as r}from"./vendor.48b4881a.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();function l(t){let e=t.getContext("2d");if(!e)throw"Could not get context";let s=e.getImageData(0,0,t.width,t.height),n={x:0,y:0},i=a({},n),o=a({},n);for(var h=0;h<s.data.length;h+=4)0!==s.data[h+3]&&((n.x<=i.x||0==i.x)&&(i.x=n.x),(n.y<=i.y||0==i.y)&&(i.y=n.y),(n.x>=o.x||0==o.x)&&(o.x=n.x),(n.y>=o.y||0==o.y)&&(o.y=n.y)),n.x+=1,n.x==t.width&&(n.x=0,n.y+=1);return{upperLeft:i,lowerRight:o}}let d=function(t,e,s){return new Promise(((n,i)=>{let a=l(t),o=t.toDataURL(),h=document.createElement("canvas");h||i("Canvas failed to initialize"),h.width=28,h.height=28;let c=h.getContext("2d"),r=document.createElement("img");r.src=o,r.onload=()=>{if(null===c)return void i("Context failed to initialize");c.scale(e/r.width,s/r.height),c.drawImage(function(t){let{upperLeft:e,lowerRight:s}=l(t),n=document.createElement("canvas"),i=n.getContext("2d");if(!i)throw"Could not get context";n.width=500,n.height=500;let a=s.x-e.x,o=s.y-e.y,h=a/o;return a>o?(a=300,o=a/h):(o=300,a=o*h),i.drawImage(t,e.x,e.y,s.x-e.x,s.y-e.y,250-a/2,250-o/2,a,o),n}(t),0,0);let o=c.getImageData(0,0,e,s),d=[],u=[];for(var v=0;v<o.data.length;v+=4)0==o.data[v+3]?(o.data[v]=0,o.data[v+1]=0,o.data[v+2]=0,o.data[v+3]=255,u.push(0)):(o.data[v]=255,o.data[v+1]=255,o.data[v+2]=255,u.push(255==o.data[v+3]?255:0)),u.length==e&&(d.push(u),u=[]);c.putImageData(o,0,0),n({img:h.toDataURL(),imgGreyScaleMatrix:d,boundingBox:a})}}))};class u extends h.Component{constructor(t){super(t),o(this,"canvasRef"),o(this,"imgRef"),o(this,"canvas"),o(this,"canvasBoundingRect"),o(this,"context"),o(this,"state"),o(this,"canvas2"),o(this,"context2"),this.state={pen:{color:"#ff7f90",size:30},pts:[],isDown:!1,guess:""},this.canvasRef=h.createRef(),this.imgRef=h.createRef(),this.canvas=null,this.context=null,this.canvasBoundingRect=null,this.drawPoints=this.drawPoints.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.getContext=this.getContext.bind(this),this.clear=this.clear.bind(this),this.updateImg=this.updateImg.bind(this),this.getEventRelativeCoordinates=this.getEventRelativeCoordinates.bind(this),this.handleResize=this.handleResize.bind(this)}getContext(){var t,e,s,n;this.canvasRef.current&&(this.canvas=this.canvasRef.current,this.canvas2=document.createElement("canvas"),this.context2=null!=(e=null==(t=this.canvas2)?void 0:t.getContext("2d"))?e:null,this.context=null!=(n=null==(s=this.canvas)?void 0:s.getContext("2d"))?n:null,this.canvas&&(this.canvasBoundingRect=this.canvas.getBoundingClientRect(),this.canvas2.width=this.canvas.clientWidth,this.canvas2.height=this.canvas.clientHeight))}componentDidMount(){this.getContext(),window.addEventListener("resize",this.handleResize)}componentDidUpdate(){if(this.canvas2&&this.context2&&this.canvas){let t=this.canvas2;this.getContext(),this.context2.drawImage(t,0,0,this.canvas.width,this.canvas.height)}}handleResize(){this.componentDidUpdate()}clear(){this.context&&this.canvas&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2&&this.canvas2&&this.context2.clearRect(0,0,this.canvas2.width,this.canvas2.height)}updateImg(){this.canvas&&d(this.canvas,28,28).then((({img:t,imgGreyScaleMatrix:e,boundingBox:s})=>{if(this.imgRef.current&&(this.imgRef.current.src=t),c.post("http://localhost:8080/img",{img:e}).then((t=>{this.setState({guess:t.data.guess.toString()})})),!this.context)return null}))}onMouseDown(t){t.preventDefault(),this.state.isDown=!0,this.state.pts.push(this.getEventRelativeCoordinates(t)),this.drawPoints()}onTouchStart(t){this.state.isDown=!0,this.getEventRelativeCoordinates(t).forEach((t=>{this.state.pts.push(t)})),this.drawPoints()}onMouseUp(t){t.preventDefault(),this.state.isDown=!1,this.context2&&this.canvas&&this.context2.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2&&this.canvas&&this.context2.drawImage(this.canvas,0,0),this.setState({pts:[]}),this.updateImg()}onTouchEnd(t){this.state.isDown=!1,this.context2&&this.canvas&&this.context2.clearRect(0,0,this.canvas.width,this.canvas.height),this.context2&&this.canvas&&this.context2.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height),this.setState({pts:[]}),this.updateImg()}onMouseMove(t){t.preventDefault(),this.state.isDown&&this.context&&this.canvas&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas2&&this.context.drawImage(this.canvas2,0,0),this.state.pts.push(this.getEventRelativeCoordinates(t)),this.drawPoints())}onTouchMove(t){this.getEventRelativeCoordinates(t).forEach((t=>{if(!(this.state.isDown&&this.context&&this.canvas&&this.canvas2))throw"No canvas";this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.canvas2,0,0),this.state.pts.push(t),this.drawPoints()}))}getEventRelativeCoordinates(t){if(!this.canvasBoundingRect)throw"No bounding rect for canvas found";if(t.nativeEvent instanceof TouchEvent){t=t;let e=[];for(let s=0;s<t.touches.length;s++)e.push({x:(t.touches[s].clientX-this.canvasBoundingRect.left)*t.target.width/this.canvasBoundingRect.width,y:(t.touches[s].clientY-this.canvasBoundingRect.top)*t.target.height/this.canvasBoundingRect.height});return e}return{x:((t=t).clientX-this.canvasBoundingRect.left)*t.target.width/this.canvasBoundingRect.width,y:(t.clientY-this.canvasBoundingRect.top)*t.target.height/this.canvasBoundingRect.height}}drawPoints(){if(!this.context)return;this.context.lineCap="round",this.context.lineWidth=this.state.pen.size;let t=this.state.pts;var e=0,s=t.length>1?1:0;for(this.context.beginPath(),this.context.lineJoin="round",this.context.moveTo(t[0].x,t[0].y);e<t.length-s;e++)this.context.quadraticCurveTo(t[e].x,t[e].y,(t[e].x+t[e+s].x)/2,(t[e].y+t[e+s].y)/2);this.context.strokeStyle=this.state.pen.color,this.context.stroke(),this.context.closePath()}render(){return h.createElement("div",null,h.createElement("div",{className:"flex justify-between p-3 border-4 border-gray-500 border-dashed rounded-3xl mb-2"},h.createElement("div",{className:"flex flex-col justify-center"},h.createElement("button",{className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-light font-mono py-2 px-4 rounded-2xl focus:outline-none",onMouseUpCapture:()=>this.clear()},"clear")),h.createElement("div",{className:"inline-flex"},h.createElement("div",{className:"flex flex-col justify-center"},h.createElement("div",{className:"text-stroke-cyan-700 p-2 text-transparent opacity-85   overflow-hidden text-4xl text-stroke-md "},"Guess:")),h.createElement("div",{className:"flex flex-col justify-center"},h.createElement("div",{className:"text-stroke-orange-300 p-2 text-transparent opacity-85   overflow-hidden text-4xl text-stroke-md "},this.state.guess)))),h.createElement("canvas",{className:" border-4 border-gray-500 border rounded-3xl shadow-2xl",onMouseMove:t=>this.onMouseMove(t),onMouseDown:t=>this.onMouseDown(t),onMouseUp:t=>this.onMouseUp(t),onMouseLeave:t=>this.onMouseUp(t),onTouchMove:t=>this.onTouchMove(t),onTouchStart:t=>this.onTouchStart(t),onTouchEnd:t=>this.onTouchEnd(t),ref:this.canvasRef,width:"500",height:"500",style:{padding:"0",margin:"auto",display:"block",width:"100%",touchAction:"none"}}),h.createElement("img",{ref:this.imgRef,width:"200px",className:" border-4 border-gray-500"}))}}class v extends h.Component{render(){return h.createElement("div",{style:{display:"grid",placeItems:"center",width:"100%",paddingTop:"10px"}},h.createElement(u,null))}}r.render(h.createElement(h.StrictMode,null,h.createElement(v,null)),document.getElementById("root"));
